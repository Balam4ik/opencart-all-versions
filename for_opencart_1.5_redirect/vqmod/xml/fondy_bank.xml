<!-- Created using vQmod XML Generator by UKSB - http://uksb.github.com/vqgen/ //-->
<modification>
	<id><![CDATA[payment_mod]]></id>
	<version><![CDATA[1.0]]></version>
	<vqmver><![CDATA[2.4.0]]></vqmver>
	<author><![CDATA[D.M.]]></author>
	<file path="admin/controller/extension/" name="payment.php">
		<operation>
			<search position="after" index="2"><![CDATA[$this->model_user_user_group->addPermission(]]></search>
			<add><![CDATA[			if ($this->request->get['extension']=='fondy_bank')
			{
				$this->model_setting_extension->fondy_bank();
			}]]></add>
		</operation>
	</file>
	<file path="admin/model/setting/" name="extension.php">
		<operation>
			<search position="after" index="1"><![CDATA[class ModelSettingExtension extends Model {]]></search>
			<add><![CDATA[public function fondy_bank(){
$this->db->query("CREATE TABLE IF NOT EXISTS `payment_fondy_bank` (
  `order_id` int(11) NOT NULL,
  `value` mediumtext NOT NULL,
  PRIMARY KEY (`order_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
");}
]]></add>
		</operation>
	</file>
	<file path="catalog/model/checkout/" name="order.php">
		<operation>
			<search position="after" index="1"><![CDATA[$order_info = $this->getOrder($order_id);]]></search>
			<add><![CDATA[if($order_info['payment_code']=='fondy_bank' and  $value!='')
		{
			$this->db->query("INSERT INTO payment_fondy_bank SET order_id = '" . (int)$order_id . "', value = '" . $value . "' ON DUPLICATE 
KEY UPDATE value =  '" . $value . "'");
		}
]]></add>
		</operation>
		<operation>
			<search position="iafter" index="1"><![CDATA[$notify = false]]></search>
			<add><![CDATA[, $value='']]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/*/template/checkout/" name="checkout.tpl">
		<operation>
			<search position="before"><![CDATA[<h1><?php echo $heading_title; ?></h1>]]></search>
			<add><![CDATA[<?php if (isset($this->session->data ['fondy_bank_error'])) { ?>
	<div class="warning"><?php echo $this->session->data ['fondy_bank_error']; ?><img src="catalog/view/theme/default/image/close.png" alt="" class="close"></div>
	<?php }; unset($this->session->data['fondy_bank_error']); ?>]]></add>
		</operation>
	</file>
	<file path="admin/view/template/sale/" name="order_info.tpl">
		<operation>
			<search position="after"><![CDATA[ <td><?php echo $payment_method; ?></td>]]></search>
			<add><![CDATA[<?php if(isset($fondy_bank_order_status)){ ?>
          <tr>
            <td><?php  echo $text_fondy_bank_order_status; ?></td>
            <td><?php echo $fondy_bank_order_status; ?></td>
          </tr>
          <?php if(isset($fondy_bank_response_description) and $fondy_bank_response_description !='' ){ ?>
          <tr>
            <td><?php echo $text_response_description; ?></td>
            <td><?php echo $fondy_bank_response_description;  ?></td>
          </tr>
          <?php } ?>
          <?php if(isset($fondy_bank_response_code) and $fondy_bank_response_code !=''){ ?>
          <tr>
            <td><?php echo $text_response_code; ?></td>
            <td><?php echo $fondy_bank_response_code;  ?></td>
          </tr>
          <?php } ?>
          <?php } ?>]]></add>
		</operation>
	</file>
	<file path="admin/controller/sale/" name="order.php">
		<operation>
			<search index="1" position="after"><![CDATA[$order_info = $this->model_sale_order->getOrder($order_id);]]></search>
			<add><![CDATA[if($order_info['fondy_bank_info']!='') {
			$this->language->load('payment/fondy_bank');
			$fondy_bank_info = (unserialize($order_info['fondy_bank_info']));
			//print_r ($fondy_bank_info);
				$this->data['fondy_bank_order_status'] = $fondy_bank_info['order_status'];
				$this->data['fondy_bank_response_description'] = $fondy_bank_info['response_description'];
				$this->data['fondy_bank_response_code'] = $fondy_bank_info['response_code'];
				$this->data['text_response_description'] = $this->language->get('text_response_description');
				$this->data['text_fondy_bank_order_status'] = $this->language->get('text_fondy_bank_order_status');
				$this->data['text_response_code'] = $this->language->get('text_response_code');
		}]]></add>
		</operation>
	</file>
	<file path="admin/model/sale/" name="order.php">
		<operation>
			<search position="before"><![CDATA[return array(]]></search>
			<add><![CDATA[$fondy_bank_info='';
			if($order_query->row['payment_code']=='fondy_bank')
			{
				$fondy_bank_info=$this->db->query("SELECT value FROM `payment_fondy_bank` WHERE order_id = '" . (int)$order_id . "'");
			}
			]]></add>
		</operation>
		<operation>
			<search position="after"><![CDATA['payment_code'            => $order_query->row['payment_code'],]]></search>
			<add><![CDATA['fondy_bank_info'            =>  (empty($fondy_bank_info->row['value'])) ? '' : $fondy_bank_info->row['value'],]]></add>
		</operation>
	</file>
</modification>